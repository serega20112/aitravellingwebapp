# Архитектура и структура проекта

Проект следует принципам DDD (Domain-Driven Design) и Чистой архитектуры. Основная идея — изолировать доменную логику от инфраструктуры через порты и адаптеры, управлять транзакциями через Unit of Work, а зависимости собирать централизованно.

Основные слои:
- domain — доменные сущности, интерфейсы (порты), бизнес-правила. Никаких зависимостей на инфраструктуру.
- use_case — сценарии приложения (application services). Зависят только от доменных портов, получают порты через DI.
- infrastructure — адаптеры к внешним системам: БД (SQLAlchemy), AI-сервис (transformers), клиенты, конфигурация.
- repository — реализации доменных репозиториев (если отделены от infrastructure) — используют ORM.
- services — фасады/композиции над use case’ами (например, PlaceService), остаются тонкими.
- delivery — слой доставки (web): Flask роуты, схемы валидации (Pydantic), сериализация/десериализация DTO.
- tests — юнит/интеграционные тесты. Юнит-тесты используют моки портов и DummyUoW.

Ключевые паттерны:
- Ports & Adapters — интерфейсы (порты) определяются в domain/use_case; реализации (адаптеры) — в infrastructure.
- Unit of Work — IUnitOfWork в приложении, реализация SQLAlchemyUnitOfWork управляет сессией/транзакциями. Репозитории НЕ делают commit.
- Dependency Injection — все зависимости собираются в create_app.py и пробрасываются в use cases/services/роуты.

Принципы:
- use_case не импортирует инфраструктурные классы.
- Доменные типы и правила — в domain (по возможности без утяжеления, VO вводить по мере роста сложности).
- Обработка ошибок и логирование — в delivery/infrastructure, домен остаётся «чистым».

Структура каталогов (в сокращении):
- src/backend/
  - create_app.py — сборка зависимостей (DI), регистрация роутов/сервисов.
  - domain/ — порт IAIService, интерфейсы репозиториев и доменная модель.
  - use_case/ — PlaceUseCase, ProfileUseCase и др. Используют IUnitOfWork, IAIService.
  - infrastructure/ — SQLAlchemy, реализация AIService, конфигурация модели.
  - delivery/ — Flask роуты, схемы запросов/ответов.
  - services/ — тонкие фасады над use cases.
  - tests/ — unit и integration тесты.

Соглашения по коду:
- Импорты: domain/use_case всегда выше уровнем, чем infrastructure/delivery.
- DTO и схемы — в delivery; доменные сущности — в domain.
- Логика транзакций — только через Unit of Work.
